#! /bin/bash

DEFAULT_CURRENCY=monero
VALID_CURRENCIES="(monero)"

if [ -n "$1" ]; then
  CURRENCY=$1
else
  CURRENCY=$DEFAULT_CURRENCY
fi

shift

CONFIG_DIR=/usr/local/etc/xmr-stak/$CURRENCY
LOG=/var/log/xmr-stak/${CURRENCY}.log

echo $CURRENCY | grep -E $VALID_CURRENCIES > /dev/null

if [ $? -ne 0 ]; then
  echo "Bad crypto: $CURRENCY" 1>&2
  exit 1
fi

echo "Begin mining: $CURRENCY"

cd /usr/local/bin && exec xmr-stak --cpu $CONFIG_DIR/cpu.txt \
  --noNVIDIA \
  --amd $CONFIG_DIR/amd.txt \
  -c $CONFIG_DIR/config.txt \
  -C $CONFIG_DIR/pools.txt \
  -i 10000 \
  $@ >> $LOG
